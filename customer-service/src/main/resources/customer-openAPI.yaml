openapi: 3.1.0
info:
  title: Customer Service
  description: Customer Service For Tontine Application
  version: 1.0.0
servers:
  - url: 'http://localhost:7071/api'

security:
  - bearerAuth: [ ]

tags:
  - name: Customer Controller
    description: Customer Service REST Endpoints
  - name: Id Document Controller
    description: Id Document Service REST Endpoints

paths:
  /customers:
    get:
      tags:
        - Customer Controller
      summary: Returns a list of all customers
      description: Returns a list of all customers
      operationId: getAllCustomers
      responses:
        '200':
          description: Successfully retrieved customers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CustomerResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'

    post:
      tags:
        - Customer Controller
      summary: Create a new customer
      description: Create a new customer
      operationId: createCustomer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerRequest'
        required: true
      responses:
        '201':
          description: Customer successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'


  /customers/{customerId}:
    get:
      tags:
        - Customer Controller
      summary: Get a customer by ID
      description: Get a customer by ID
      operationId: getCustomerById
      parameters:
        - $ref: '#/components/parameters/customerId'
      responses:
        '200':
          description: Successfully retrieved customer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'

    put:
      tags:
        - Customer Controller
      summary: Update an existing customer
      description: Update an existing customer
      operationId: updateCustomer
      parameters:
        - $ref: '#/components/parameters/customerId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerRequest'
        required: true
      responses:
        '202':
          description: Customer successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'

    delete:
      tags:
        - Customer Controller
      summary: Delete a customer by ID
      description: Delete a customer by ID
      operationId: deleteCustomer
      parameters:
        - $ref: '#/components/parameters/customerId'
      responses:
        '204':
          description: Customer successfully deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'


  /customers/id-documents:
    get:
      tags:
        - Id Document Controller
      summary: Returns a list of all ID Documents
      description: Returns a list of all ID Documents
      operationId: getAllIdDocuments
      responses:
        '200':
          description: Successfully retrieved ID Documents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IdDocumentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'


  /customers/{customerId}/id-documents:
    get:
      tags:
        - Id Document Controller
      summary: Get ID Documents for a customer
      description: Get ID Documents for a customer
      operationId: getIdDocumentsByCustomerId
      parameters:
        - $ref: '#/components/parameters/customerId'
      responses:
        '200':
          description: Successfully retrieved ID Documents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IdDocumentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'

    post:
      tags:
        - Id Document Controller
      summary: Create an ID Document for a customer
      description: Create an ID Document for a customer
      operationId: createIdDocument
      parameters:
        - $ref: '#/components/parameters/customerId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdDocumentRequest'
        required: true
      responses:
        '201':
          description: ID Document successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdDocumentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'


  /customers/{customerId}/id-documents/{idDocumentId}:
    get:
      tags:
        - Id Document Controller
      summary: Get an ID Document by ID for a customer
      description: Get an ID Document by ID for a customer
      operationId: getIdDocumentById
      parameters:
        - $ref: '#/components/parameters/customerId'
        - $ref: '#/components/parameters/idDocumentId'
      responses:
        '200':
          description: Successfully retrieved ID Document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdDocumentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'

    put:
      tags:
        - Id Document Controller
      summary: Update an ID Document for a customer
      description: Update an ID Document for a customer
      operationId: updateIdDocument
      parameters:
        - $ref: '#/components/parameters/customerId'
        - $ref: '#/components/parameters/idDocumentId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdDocumentRequest'
        required: true
      responses:
        '202':
          description: ID Document successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdDocumentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'

    delete:
      tags:
        - Id Document Controller
      summary: Delete an ID Document by ID for a customer
      description: Delete an ID Document by ID for a customer
      operationId: deleteIdDocument
      parameters:
        - $ref: '#/components/parameters/customerId'
        - $ref: '#/components/parameters/idDocumentId'
      responses:
        '204':
          description: ID Document successfully deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        default:
          $ref: '#/components/responses/DefaultError'


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    CustomerRequest:
      type: object
      required:
        - title
        - gender
        - firstname
        - lastname
        - email
        - birthdate
        - phone
        - maritalStatus
        - address
      properties:
        title:
          $ref: '#/components/schemas/Title'
        gender:
          $ref: '#/components/schemas/Gender'
        firstname:
          type: string
          example: John
        lastname:
          type: string
          example: Doe
        email:
          type: string
          format: email
          pattern: '^(?=.{1,64}@)[A-Za-z0-9_-]+(\.[A-Za-z0-9_-]+)*@[^-][A-Za-z0-9-]+(\.[A-Za-z0-9-]+)*(\.[A-Za-z]{2,})$'
          example: john.doe@email.com
        birthdate:
          type: string
          format: date
          example: '1990-01-01'
        phone:
          type: string
          example: '+1234567890'
        maritalStatus:
          $ref: '#/components/schemas/MaritalStatus'
        address:
          $ref: '#/components/schemas/Address'

    CustomerResponse:
      type: object
      required:
        - id
        - createdAt
        - updatedAt
        - title
        - gender
        - firstname
        - lastname
        - email
        - birthdate
        - phone
        - maritalStatus
        - status
        - address
      properties:
        id:
          type: string
          format: uuid
          example: '123e4567-e89b-12d3-a456-426614174000'
        createdAt:
          type: string
          format: date-time
          example: '2023-01-01T12:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-01-02T12:00:00Z'
        title:
          $ref: '#/components/schemas/Title'
        gender:
          $ref: '#/components/schemas/Gender'
        firstname:
          type: string
          example: John
        lastname:
          type: string
          example: Doe
        email:
          type: string
          format: email
          example:
        birthdate:
          type: string
          format: date
          example: '1990-01-01'
        phone:
          type: string
          example: '+1234567890'
        maritalStatus:
          $ref: '#/components/schemas/MaritalStatus'
        status:
          $ref: '#/components/schemas/Status'
        address:
          $ref: '#/components/schemas/Address'

    Address:
      type: object
      required:
        - street
        - city
        - state
        - zipCode
        - country
      properties:
        street:
          type: string
          example: '123 Main St'
        zipCode:
          type: string
          example: '12345'
        city:
          type: string
          example: 'Anytown'
        state:
          type: string
          example: 'CA'
        country:
          type: string
          example: 'USA'

    IdDocumentRequest:
      type: object
      required:
        - nationality
        - documentNumber
        - issueDate
        - expiryDate
        - issuedBy
        - documentType
      properties:
        nationality:
          type: string
          example: 'German'
        documentNumber:
          type: string
          example: '1234567890123456'
        issueDate:
          type: string
          format: date
          example: '2020-01-01'
        expiryDate:
          type: string
          format: date
          example: '2030-01-01'
        issuedBy:
          type: string
          example: 'Government of Germany'
        documentType:
          $ref: '#/components/schemas/DocumentType'

    IdDocumentResponse:
      type: object
      required:
        - id
        - createdAt
        - updatedAt
        - customerId
        - nationality
        - documentNumber
        - issueDate
        - expiryDate
        - issuedBy
        - documentType
      properties:
        id:
          type: string
          format: uuid
          example: '123e4567-e89b-12d3-a456-426614174000'
        createdAt:
          type: string
          format: date-time
          example: '2023-01-01T12:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-01-02T12:00:00Z'
        customerId:
          type: string
          format: uuid
          example: '123e4567-e89b-12d3-a456-426614174000'
        nationality:
          type: string
          example: 'German'
        documentNumber:
          type: string
          example: '1234567890123456'
        issueDate:
          type: string
          format: date
          example: '2020-01-01'
        expiryDate:
          type: string
          format: date
          example: '2030-01-01'
        issuedBy:
          type: string
          example: 'Government of Germany'
        documentType:
          $ref: '#/components/schemas/DocumentType'

    Membership:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '123e4567-e89b-12d3-a456-426614174000'
        createdAt:
          type: string
          format: date-time
          example: '2023-01-01T12:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-01-02T12:00:00Z'
        customerId:
          type: string
          format: uuid
          example: '123e4567-e89b-12d3-a456-426614174000'
        tontineId:
          type: string
          format: uuid
          example: '123e4567-e89b-12d3-a456-426614174001'
        joinDate:
            type: string
            format: date
            example: '2023-01-01'
        leftDate:
            type: string
            format: date
            nullable: true
            example: '2024-01-01'
        role:
          $ref: '#/components/schemas/Role'
        positionInRotation:
          type: integer
          example: 1
        active:
          type: boolean
          example: true

    MaritalStatus:
      type: string
      enum:
        - SINGLE
        - MARRIED
        - DIVORCED
        - WIDOWED
      example: SINGLE

    Title:
      type: string
      enum:
        - PHD
        - DR
        - MSC
        - BSC
        - ING
      example: PHD

    Gender:
      type: string
      enum:
        - MALE
        - FEMALE
        - OTHER
      example: MALE

    DocumentType:
      type: string
      enum:
        - ID_CARD
        - PASSPORT
        - DRIVER_LICENSE
        - BIRTH_CERTIFICATE
        - OTHER
      example: ID_CARD

    Role:
      type: string
      enum:
        - ADMIN
        - GUEST
        - PRESIDENT
        - VICE_PRESIDENT
        - SECRETARY
        - VICE_SECRETARY
        - TREASURER
        - VICE_TREASURER
        - SENSOR
        - VICE_SENSOR
        - MEMBER
        - ASSOCIATE
        - FOUNDER
      description: Position of the user in the system
      example: MEMBER

    Status:
        type: string
        enum:
            - ACTIVE
            - INACTIVE
            - SUSPENDED
        example: ACTIVE

    Error:
      type: object
      required:
        - timestamp
        - status
        - error
        - message
        - path
      properties:
        timestamp:
          type: string
          format: date-time
          example: '2023-01-01T12:00:00Z'
        status:
          type: integer
          example: 400
        error:
          type: string
          example: Bad Request
        path:
          type: string
          example: /api/customers
        message:
          type: string
          example: An unexpected error occurred
        fieldErrors:
          type: object
          description: Field-specific errors
          additionalProperties:
            type: string


  parameters:
    customerId:
      name: customerId
      in: path
      required: true
      description: Unique identifier for the customer
      schema:
        type: string
        format: uuid
        example: '123e4567-e89b-12d3-a456-426614174000'

    idDocumentId:
      name: idDocumentId
      in: path
      required: true
      description: Unique identifier for the ID Document
      schema:
        type: string
        format: uuid
        example: '123e4567-e89b-12d3-a456-426614174001'


  responses:
    Unauthorized:
      description: Unauthorized Access
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2023-01-01T12:00:00Z'
            status: 401
            error: 'Unauthorized'
            message: 'Access token is missing or invalid'


    NotFound:
      description: Customer not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2023-01-01T12:00:00Z'
            status: 404
            error: 'Not Found'
            message: 'Customer with the specified ID does not exist'


    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2023-01-01T12:00:00Z'
            status: 500
            error: 'Internal Server Error'
            message: 'An unexpected error occurred while processing the request'


    DefaultError:
      description: Default error response
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2023-01-01T12:00:00Z'
            status: 500
            error: 'Internal Server Error'
            message: 'An unexpected error occurred'


    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2023-01-01T12:00:00Z'
            status: 400
            error: 'Bad Request'
            message: 'The request was invalid or cannot be served'
            fieldErrors:
              firstname: 'First name is required'
              email: 'Email format is invalid'
